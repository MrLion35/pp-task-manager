<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro | Advanced Task Manager</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ“</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #4ade80;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #6366f1;
            --secondary: #4f46e5;
            --accent: #60a5fa;
            --light: #1e293b;
            --dark: #f8fafc;
            --card-bg: rgba(30, 41, 59, 0.9);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            transition: var(--transition);
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1e3a8a 0%, #581c87 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }

        .logo i {
            color: var(--accent);
            font-size: 2rem;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--card-bg);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--dark);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .stats {
            display: flex;
            gap: 15px;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--secondary);
        }

        .section-title i {
            color: var(--primary);
        }

        .task-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--card-bg);
            color: var(--dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--dark);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e2e8f0;
            background: var(--card-bg);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            color: var(--dark);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .task-item {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: grab;
        }

        .task-item:active {
            cursor: grabbing;
        }

        .task-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--success);
        }

        .task-item.high-priority {
            border-left-color: var(--danger);
        }

        .task-item.medium-priority {
            border-left-color: var(--warning);
        }

        .task-item.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
        }

        .task-description {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: #94a3b8;
            flex-wrap: wrap;
        }

        .task-tag {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .task-priority {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .priority-medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .priority-low {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background: #f1f5f9;
            color: #64748b;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .edit-btn:hover {
            background: var(--primary);
            color: white;
        }

        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-tag {
            padding: 5px 12px;
            background: var(--primary);
            color: white;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .category-tag.active {
            background: var(--secondary);
        }

        .tools-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .tool-btn {
            padding: 10px;
            border: 1px solid #e2e8f0;
            background: var(--card-bg);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .tool-btn:hover {
            background: var(--primary);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            color: var(--dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }

        footer {
            text-align: center;
            padding: 20px;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }

            .stats {
                width: 100%;
                justify-content: space-around;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .task-actions {
                align-self: flex-end;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.warning {
            background: var(--warning);
        }

        .notification.error {
            background: var(--danger);
        }

        .custom-select {
            position: relative;
        }

        .custom-select select {
            appearance: none;
            padding-right: 40px;
        }

        .custom-select::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #64748b;
        }

        .category-input-container {
            display: flex;
            gap: 10px;
        }

        .category-input-container input {
            flex: 1;
        }

        .category-input-container button {
            white-space: nowrap;
        }

        .alarm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            display: none;
        }

        .alarm-modal {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: pulse 1.5s infinite;
            color: var(--dark);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .alarm-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--danger);
        }

        .alarm-tasks {
            text-align: left;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .alarm-task {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .alarm-task:last-child {
            border-bottom: none;
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .sort-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .sort-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: var(--card-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .sort-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }


        [data-theme="dark"] .sort-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--dark);
        }

        [data-theme="dark"] .sort-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }


        .danger-zone {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .danger-zone h4 {
            color: var(--danger);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alarm-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-tasks"></i>
                <span>TaskFlow Pro</span>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pendingTasks">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add New Task</span>
                </h2>
                <form class="task-form" id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Task Title</label>
                        <input type="text" id="taskTitle" class="form-control" placeholder="What needs to be done?"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" class="form-control" placeholder="Add details..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskCategory">Category</label>
                        <div class="category-input-container">
                            <input type="text" id="taskCategory" class="form-control" list="categoryOptions"
                                placeholder="Select or type a category">
                            <button type="button" class="btn btn-outline" id="addCategoryBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <datalist id="categoryOptions">
                            <!-- Categories will be dynamically populated -->
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label for="taskTags">Tags (comma separated)</label>
                        <input type="text" id="taskTags" class="form-control" placeholder="urgent, important, etc.">
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <div class="custom-select">
                            <select id="taskPriority" class="form-control">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="date" id="taskDueDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="taskRecurrence">Recurrence</label>
                        <div class="custom-select">
                            <select id="taskRecurrence" class="form-control">
                                <option value="none">No Recurrence</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Add Task
                    </button>
                </form>

                <div class="tools-section">
                    <h3 class="section-title">
                        <i class="fas fa-tools"></i>
                        <span>Tools</span>
                    </h3>
                    <div class="tools-grid">
                        <button class="tool-btn" id="exportBtn">
                            <i class="fas fa-download"></i>
                            Export Tasks
                        </button>
                        <button class="tool-btn" id="importBtn">
                            <i class="fas fa-upload"></i>
                            Import Tasks
                        </button>
                        <button class="tool-btn" id="shareBtn">
                            <i class="fas fa-share-alt"></i>
                            Share List
                        </button>
                        <button class="tool-btn" id="remindersBtn">
                            <i class="fas fa-bell"></i>
                            Set Reminder
                        </button>
                    </div>

                    <div class="danger-zone">
                        <h4><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
                        <button class="btn btn-danger" id="resetDataBtn">
                            <i class="fas fa-trash"></i>
                            Reset All Data
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">
                    <i class="fas fa-list-check"></i>
                    <span>Your Tasks</span>
                </h2>

                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search tasks...">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="sort-options">
                    <button class="sort-btn active" data-sort="created">Newest First</button>
                    <button class="sort-btn" data-sort="due">Due Date</button>
                    <button class="sort-btn" data-sort="priority">Priority</button>
                    <button class="sort-btn" data-sort="title">Title</button>
                </div>

                <div class="categories" id="categoryFilters">
                    <div class="category-tag active" data-category="all">All</div>
                    <!-- Categories will be dynamically populated -->
                </div>

                <div class="filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                    <button class="filter-btn" data-filter="high">High Priority</button>
                    <button class="filter-btn" data-filter="today">Due Today</button>
                    <button class="filter-btn" data-filter="overdue">Overdue</button>
                </div>

                <div class="progress-bar">
                    <div class="progress" id="progressBar" style="width: 0%"></div>
                </div>

                <div class="task-list" id="taskList">
                    <!-- Tasks will be populated here -->
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>No tasks yet</h3>
                        <p>Add a task to get started!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div class="modal" id="shareModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Share Task List</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <p>Copy this link to share your task list:</p>
                <div class="form-group">
                    <input type="text" id="shareLink" class="form-control" readonly>
                </div>
                <button class="btn btn-primary" id="copyLinkBtn">
                    <i class="fas fa-copy"></i>
                    Copy Link
                </button>
            </div>
        </div>

        <div class="modal" id="reminderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Set Reminder</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <p>You will be reminded of tasks due today and overdue tasks.</p>
                <div class="form-group">
                    <label for="reminderTime">Reminder Time</label>
                    <input type="time" id="reminderTime" class="form-control" value="09:00">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableNotifications"> Enable Browser Notifications
                    </label>
                </div>
                <div class="alarm-controls">
                    <button class="btn btn-outline" id="testAlarmBtn">
                        <i class="fas fa-volume-up"></i>
                        Test Alarm Sound
                    </button>
                </div>
                <button class="btn btn-primary" id="saveReminderBtn">
                    <i class="fas fa-bell"></i>
                    Save Reminder
                </button>
            </div>
        </div>

        <!-- Reset Confirmation Modal -->
        <div class="modal" id="resetModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Reset All Data</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <p>This action will permanently delete all your tasks, categories, and settings. This cannot be undone!
                </p>
                <p>Are you sure you want to continue?</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-danger" id="confirmResetBtn">
                        <i class="fas fa-trash"></i>
                        Yes, Reset Everything
                    </button>
                    <button class="btn btn-outline" id="cancelResetBtn">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Alarm Overlay -->
        <div class="alarm-overlay" id="alarmOverlay">
            <div class="alarm-modal">
                <h2 class="alarm-title"><i class="fas fa-bell"></i> Task Reminder</h2>
                <p>You have tasks that need your attention:</p>
                <div class="alarm-tasks" id="alarmTasks">
                    <!-- Tasks for alarm will be populated here -->
                </div>
                <div class="alarm-controls">
                    <button class="btn btn-primary" id="dismissAlarmBtn">
                        <i class="fas fa-check"></i> Dismiss
                    </button>
                    <button class="btn btn-outline" id="snoozeAlarmBtn">
                        <i class="fas fa-clock"></i> Snooze (5 min)
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>TaskFlow Pro &copy; <span id="currentYear"></span> | Stay productive!</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully!</span>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;">

    <script>
        // DOM Elements
        const taskForm = document.getElementById('taskForm');
        const taskList = document.getElementById('taskList');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const categoryFilters = document.getElementById('categoryFilters');
        const totalTasksEl = document.getElementById('totalTasks');
        const completedTasksEl = document.getElementById('completedTasks');
        const pendingTasksEl = document.getElementById('pendingTasks');
        const currentYearEl = document.getElementById('currentYear');
        const themeToggle = document.getElementById('themeToggle');
        const searchInput = document.getElementById('searchInput');
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const shareBtn = document.getElementById('shareBtn');
        const remindersBtn = document.getElementById('remindersBtn');
        const resetDataBtn = document.getElementById('resetDataBtn');
        const shareModal = document.getElementById('shareModal');
        const reminderModal = document.getElementById('reminderModal');
        const resetModal = document.getElementById('resetModal');
        const closeModals = document.querySelectorAll('.close-modal');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const shareLink = document.getElementById('shareLink');
        const saveReminderBtn = document.getElementById('saveReminderBtn');
        const testAlarmBtn = document.getElementById('testAlarmBtn');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');
        const importFile = document.getElementById('importFile');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const taskCategory = document.getElementById('taskCategory');
        const categoryOptions = document.getElementById('categoryOptions');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const sortBtns = document.querySelectorAll('.sort-btn');
        const progressBar = document.getElementById('progressBar');
        const alarmOverlay = document.getElementById('alarmOverlay');
        const alarmTasks = document.getElementById('alarmTasks');
        const dismissAlarmBtn = document.getElementById('dismissAlarmBtn');
        const snoozeAlarmBtn = document.getElementById('snoozeAlarmBtn');
        const enableNotifications = document.getElementById('enableNotifications');

        // Task data
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || ['Work', 'Personal', 'Shopping', 'Health', 'Other'];
        let currentFilter = 'all';
        let currentCategory = 'all';
        let currentSort = 'created';
        let searchQuery = '';
        let dragSrcEl = null;
        let alarmInterval = null;
        let alarmAudioContext = null;
        let alarmOscillator = null;
        let alarmGainNode = null;
        let isAlarmPlaying = false;

        // Set current year
        currentYearEl.textContent = new Date().getFullYear();

        // Initialize the app
        function init() {
            updateCategoryOptions();
            updateCategoryFilters();
            renderTasks();
            updateStats();
            checkReminders();
            loadTheme();
            setupDragAndDrop();
            startAlarmCheck();

            // Request notification permission if not already granted
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Load saved reminder settings
            const savedTime = localStorage.getItem('reminderTime');
            if (savedTime) {
                document.getElementById('reminderTime').value = savedTime;
            }

            const enableNotif = localStorage.getItem('enableNotifications');
            if (enableNotif) {
                enableNotifications.checked = enableNotif === 'true';
            }
        }

        // Add these variables at the top with other global variables
        let alarmTimeout = null;
        let alarmStartTime = null;
        let alarmDuration = 60000; // 1 minute in milliseconds

        // Replace the createNoisyAlarm function with this continuous version
        function createNoisyAlarm() {
            if (alarmAudioContext) {
                stopAlarm(); // Stop any existing alarm first
            }

            try {
                alarmAudioContext = new (window.AudioContext || window.webkitAudioContext)();

                // Create multiple oscillators for a more complex, continuous sound
                const oscillators = [];
                const gainNodes = [];

                // Create 3 different oscillators with different frequencies
                const frequencies = [440, 554.37, 659.25]; // A, C#, E
                const types = ['sawtooth', 'square', 'triangle'];

                for (let i = 0; i < 3; i++) {
                    const oscillator = alarmAudioContext.createOscillator();
                    const gainNode = alarmAudioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(alarmAudioContext.destination);

                    oscillator.type = types[i];
                    oscillator.frequency.setValueAtTime(frequencies[i], alarmAudioContext.currentTime);

                    // Add some frequency modulation for a more alarming sound
                    oscillator.frequency.setValueAtTime(frequencies[i] * 0.8, alarmAudioContext.currentTime + 0.5);
                    oscillator.frequency.setValueAtTime(frequencies[i] * 1.2, alarmAudioContext.currentTime + 1);

                    // Set gain with some variation
                    gainNode.gain.setValueAtTime(0.2 + (i * 0.1), alarmAudioContext.currentTime);

                    oscillators.push(oscillator);
                    gainNodes.push(gainNode);

                    // Start the oscillator
                    oscillator.start();
                }

                alarmOscillator = oscillators[0]; // Keep reference to first one for stopping
                isAlarmPlaying = true;
                alarmStartTime = Date.now();

                // Schedule continuous modulation to keep the alarm sounding
                scheduleAlarmModulation(oscillators, gainNodes);

                // Set timeout to stop after 1 minute if not already stopped
                alarmTimeout = setTimeout(() => {
                    if (isAlarmPlaying) {
                        stopAlarm();
                        showNotification('Alarm has been automatically dismissed after 1 minute', 'warning');
                    }
                }, alarmDuration);

            } catch (error) {
                console.error('Error creating alarm sound:', error);
                // Fallback: Use continuous beeping if Web Audio API is not supported
                fallbackContinuousAlarm();
            }
        }

        // Helper function to schedule continuous modulation
        function scheduleAlarmModulation(oscillators, gainNodes) {
            if (!isAlarmPlaying) return;

            const currentTime = alarmAudioContext.currentTime;
            const elapsed = Date.now() - alarmStartTime;

            // Continue modulation for the full duration
            if (elapsed < alarmDuration) {
                // Random modulation to keep the alarm attention-grabbing
                oscillators.forEach((oscillator, index) => {
                    const baseFreq = [440, 554.37, 659.25][index];
                    const randomVariation = 0.8 + Math.random() * 0.4;
                    oscillator.frequency.setValueAtTime(baseFreq * randomVariation, currentTime + 0.1);

                    // Pulsing volume effect
                    gainNodes[index].gain.setValueAtTime(0.2 + (index * 0.1), currentTime);
                    gainNodes[index].gain.exponentialRampToValueAtTime(0.05 + (index * 0.05), currentTime + 0.3);
                    gainNodes[index].gain.exponentialRampToValueAtTime(0.2 + (index * 0.1), currentTime + 0.6);
                });

                // Schedule next modulation
                setTimeout(() => scheduleAlarmModulation(oscillators, gainNodes), 600);
            }
        }

        // Replace the fallbackAlarm function with a continuous version
        function fallbackContinuousAlarm() {
            try {
                let beepCount = 0;
                const maxBeeps = 100; // Approximately 1 minute of beeps

                function playBeep() {
                    if (!isAlarmPlaying || beepCount >= maxBeeps) return;

                    const beep = new Audio(`data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=`);
                    beep.volume = 0.3;
                    beep.play().catch(e => console.log('Fallback alarm play failed:', e));

                    beepCount++;

                    // Schedule next beep (every 600ms for continuous sound)
                    if (beepCount < maxBeeps) {
                        setTimeout(playBeep, 600);
                    }
                }

                playBeep();
                alarmStartTime = Date.now();

                // Set timeout to stop after 1 minute
                alarmTimeout = setTimeout(() => {
                    if (isAlarmPlaying) {
                        stopAlarm();
                        showNotification('Alarm has been automatically dismissed after 1 minute', 'warning');
                    }
                }, alarmDuration);

            } catch (e) {
                console.log('Fallback alarm not supported');
            }
        }

        // Update the stopAlarm function to clear the timeout
        function stopAlarm() {
            if (alarmTimeout) {
                clearTimeout(alarmTimeout);
                alarmTimeout = null;
            }

            if (alarmOscillator) {
                alarmOscillator.stop();
                alarmOscillator = null;
            }
            if (alarmAudioContext) {
                alarmAudioContext.close();
                alarmAudioContext = null;
            }
            isAlarmPlaying = false;
            alarmStartTime = null;
        }

        // Update the testAlarm function to only test for 3 seconds
        function testAlarm() {
            // For testing, only play for 3 seconds
            createNoisyAlarm();

            // Stop after 3 seconds for test
            setTimeout(() => {
                if (isAlarmPlaying) {
                    stopAlarm();
                }
            }, 3000);

            showNotification('Testing alarm sound for 3 seconds!', 'warning');
        }

        // Update the dismissAlarm function
        function dismissAlarm() {
            alarmOverlay.style.display = 'none';
            stopAlarm();
            showNotification('Alarm dismissed', 'success');
        }

        // Update the snoozeAlarm function
        function snoozeAlarm() {
            alarmOverlay.style.display = 'none';
            stopAlarm();

            // Set a timeout to show the alarm again in 5 minutes
            setTimeout(() => {
                checkReminders();
            }, 5 * 60 * 1000); // 5 minutes

            showNotification('Alarm snoozed for 5 minutes', 'warning');
        }

        // Update the close modal handler for alarm overlay
        window.addEventListener('click', (event) => {
            if (event.target === shareModal) {
                shareModal.style.display = 'none';
            }
            if (event.target === reminderModal) {
                reminderModal.style.display = 'none';
            }
            if (event.target === resetModal) {
                resetModal.style.display = 'none';
            }
            if (event.target === alarmOverlay) {
                alarmOverlay.style.display = 'none';
                stopAlarm();
                showNotification('Alarm dismissed', 'success');
            }
        });
        // Test alarm sound
        function testAlarm() {
            createNoisyAlarm();
            showNotification('Testing alarm sound!', 'warning');
        }

        // Update category options in the form
        function updateCategoryOptions() {
            categoryOptions.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                categoryOptions.appendChild(option);
            });
        }

        // Update category filters
        function updateCategoryFilters() {
            // Clear existing filters except "All"
            const allCategory = categoryFilters.querySelector('[data-category="all"]');
            categoryFilters.innerHTML = '';
            categoryFilters.appendChild(allCategory);

            // Add categories from data
            categories.forEach(category => {
                const categoryTag = document.createElement('div');
                categoryTag.className = 'category-tag';
                categoryTag.setAttribute('data-category', category);
                categoryTag.textContent = category;

                // Set active class if this category is the current one
                if (category === currentCategory) {
                    categoryTag.classList.add('active');
                }

                categoryFilters.appendChild(categoryTag);
            });

            // Update "All" category active state
            if (currentCategory === 'all') {
                allCategory.classList.add('active');
            } else {
                allCategory.classList.remove('active');
            }
        }

        // Add new category
        function addNewCategory() {
            const newCategory = taskCategory.value.trim();
            if (newCategory && !categories.includes(newCategory)) {
                categories.push(newCategory);
                localStorage.setItem('categories', JSON.stringify(categories));
                updateCategoryOptions();
                updateCategoryFilters();
                showNotification(`Category "${newCategory}" added successfully!`);
            } else if (categories.includes(newCategory)) {
                showNotification(`Category "${newCategory}" already exists!`, 'warning');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        // Update theme icon
        function updateThemeIcon(theme) {
            const icon = themeToggle.querySelector('i');
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            taskList.addEventListener('dragstart', handleDragStart);
            taskList.addEventListener('dragover', handleDragOver);
            taskList.addEventListener('dragenter', handleDragEnter);
            taskList.addEventListener('dragleave', handleDragLeave);
            taskList.addEventListener('drop', handleDrop);
            taskList.addEventListener('dragend', handleDragEnd);
        }

        // Drag and drop handlers
        function handleDragStart(e) {
            dragSrcEl = e.target.closest('.task-item');
            if (!dragSrcEl) return;

            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', dragSrcEl.innerHTML);

            setTimeout(() => {
                dragSrcEl.classList.add('dragging');
            }, 0);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            const taskItem = e.target.closest('.task-item');
            if (taskItem) {
                taskItem.classList.add('over');
            }
        }

        function handleDragLeave(e) {
            const taskItem = e.target.closest('.task-item');
            if (taskItem) {
                taskItem.classList.remove('over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();

            const dropTarget = e.target.closest('.task-item');
            if (!dropTarget || dragSrcEl === dropTarget) return;

            // Get task IDs
            const dragId = dragSrcEl.getAttribute('data-id');
            const dropId = dropTarget.getAttribute('data-id');

            // Find task indices
            const dragIndex = tasks.findIndex(task => task.id === dragId);
            const dropIndex = tasks.findIndex(task => task.id === dropId);

            // Reorder tasks
            if (dragIndex > -1 && dropIndex > -1) {
                const [removed] = tasks.splice(dragIndex, 1);
                tasks.splice(dropIndex, 0, removed);
                saveTasks();
                renderTasks();
            }
        }

        function handleDragEnd(e) {
            document.querySelectorAll('.task-item').forEach(item => {
                item.classList.remove('over', 'dragging');
            });
        }

        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Format date for display
        function formatDate(dateString) {
            if (!dateString) return '';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Check if a date is today
        function isToday(dateString) {
            if (!dateString) return false;
            const today = new Date().toDateString();
            const taskDate = new Date(dateString).toDateString();
            return today === taskDate;
        }

        // Check if a date is overdue
        function isOverdue(dateString) {
            if (!dateString) return false;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const taskDate = new Date(dateString);
            taskDate.setHours(0, 0, 0, 0);
            return taskDate < today;
        }

        // Update statistics
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(task => task.completed).length;
            const pending = total - completed;

            totalTasksEl.textContent = total;
            completedTasksEl.textContent = completed;
            pendingTasksEl.textContent = pending;

            // Update progress bar
            const progress = total > 0 ? (completed / total) * 100 : 0;
            progressBar.style.width = `${progress}%`;
        }

        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateStats();
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Sort tasks
        function sortTasks() {
            switch (currentSort) {
                case 'created':
                    tasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'due':
                    tasks.sort((a, b) => {
                        if (!a.dueDate && !b.dueDate) return 0;
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    });
                    break;
                case 'priority':
                    const priorityOrder = { high: 3, medium: 2, low: 1 };
                    tasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
                    break;
                case 'title':
                    tasks.sort((a, b) => a.title.localeCompare(b.title));
                    break;
            }
        }

        // Check for due reminders
        function checkReminders() {
            const today = new Date().toDateString();
            const reminderTime = localStorage.getItem('reminderTime') || '09:00';
            const lastReminder = localStorage.getItem('lastReminder');

            // Don't show reminder if already shown today
            if (lastReminder === today) return;

            const now = new Date();
            const [hours, minutes] = reminderTime.split(':');
            const reminderDate = new Date();
            reminderDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

            // Check if it's time for reminder
            if (now >= reminderDate) {
                const dueTasks = tasks.filter(task =>
                    !task.completed &&
                    task.dueDate &&
                    (isToday(task.dueDate) || isOverdue(task.dueDate))
                );

                if (dueTasks.length > 0) {
                    showAlarm(dueTasks);
                    localStorage.setItem('lastReminder', today);

                    // Show browser notification if enabled
                    if (localStorage.getItem('enableNotifications') === 'true' && 'Notification' in window && Notification.permission === 'granted') {
                        new Notification('TaskFlow Pro Reminder', {
                            body: `You have ${dueTasks.length} task(s) due today or overdue!`,
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">âœ“</text></svg>'
                        });
                    }
                }
            }
        }

        // Show alarm overlay
        function showAlarm(dueTasks) {
            alarmTasks.innerHTML = '';
            dueTasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'alarm-task';
                taskEl.innerHTML = `
                        <strong>${task.title}</strong> - Due: ${formatDate(task.dueDate)}
                        ${isOverdue(task.dueDate) ? ' <span style="color: var(--danger);">(OVERDUE)</span>' : ''}
                    `;
                alarmTasks.appendChild(taskEl);
            });

            alarmOverlay.style.display = 'flex';

            // Play the noisy alarm
            createNoisyAlarm();
        }

        // Snooze alarm for 5 minutes
        function snoozeAlarm() {
            alarmOverlay.style.display = 'none';
            stopAlarm();

            // Set a timeout to show the alarm again in 5 minutes
            setTimeout(() => {
                checkReminders();
            }, 5 * 60 * 1000); // 5 minutes

            showNotification('Alarm snoozed for 5 minutes', 'warning');
        }

        // Start alarm check interval
        function startAlarmCheck() {
            // Clear existing interval
            if (alarmInterval) clearInterval(alarmInterval);

            // Check every minute
            alarmInterval = setInterval(checkReminders, 60000);
        }

        // Render tasks based on current filter, category, and search
        function renderTasks() {
            // Sort tasks first
            sortTasks();

            // Filter tasks
            let filteredTasks = tasks.filter(task => {
                // Category filter
                if (currentCategory !== 'all' && task.category !== currentCategory) {
                    return false;
                }

                // Search filter
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    const titleMatch = task.title.toLowerCase().includes(query);
                    const descMatch = task.description.toLowerCase().includes(query);
                    const tagMatch = task.tags.some(tag => tag.toLowerCase().includes(query));

                    if (!titleMatch && !descMatch && !tagMatch) {
                        return false;
                    }
                }

                // Status filter
                if (currentFilter === 'pending') {
                    return !task.completed;
                } else if (currentFilter === 'completed') {
                    return task.completed;
                } else if (currentFilter === 'high') {
                    return task.priority === 'high' && !task.completed;
                } else if (currentFilter === 'today') {
                    return task.dueDate && isToday(task.dueDate) && !task.completed;
                } else if (currentFilter === 'overdue') {
                    return task.dueDate && isOverdue(task.dueDate) && !task.completed;
                }

                return true;
            });

            // Clear task list
            taskList.innerHTML = '';

            // Show empty state if no tasks
            if (filteredTasks.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                        <i class="fas fa-clipboard-list"></i>
                        <h3>No tasks found</h3>
                        <p>${currentFilter === 'all' && currentCategory === 'all' && !searchQuery ? 'Add a task to get started!' : 'No tasks match your criteria'}</p>
                    `;
                taskList.appendChild(emptyState);
                return;
            }

            // Render each task
            filteredTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''} ${task.priority}-priority`;
                taskItem.setAttribute('data-id', task.id);
                taskItem.setAttribute('draggable', 'true');

                let dueDateText = '';
                if (task.dueDate) {
                    if (isOverdue(task.dueDate) && !task.completed) {
                        dueDateText = `<span style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Overdue: ${formatDate(task.dueDate)}</span>`;
                    } else if (isToday(task.dueDate) && !task.completed) {
                        dueDateText = `<span style="color: var(--warning);"><i class="fas fa-clock"></i> Due today</span>`;
                    } else {
                        dueDateText = `<span><i class="far fa-calendar"></i> ${formatDate(task.dueDate)}</span>`;
                    }
                }

                taskItem.innerHTML = `
                        <div class="task-content">
                            <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-id="${task.id}">
                                ${task.completed ? '<i class="fas fa-check"></i>' : ''}
                            </div>
                            <div class="task-details">
                                <div class="task-title">${task.title}</div>
                                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                                <div class="task-meta">
                                    <span class="task-priority priority-${task.priority}">${task.priority}</span>
                                    <span class="task-tag">${task.category}</span>
                                    ${task.tags.length > 0 ? task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('') : ''}
                                    ${dueDateText}
                                    ${task.recurrence !== 'none' ? `<span><i class="fas fa-redo"></i> ${task.recurrence}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <div class="action-btn edit-btn" data-id="${task.id}">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="action-btn delete-btn" data-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                    `;
                taskList.appendChild(taskItem);
            });

            // Add event listeners to task actions
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', toggleTask);
            });

            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', editTask);
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', deleteTask);
            });
        }

        // Add new task
        function addTask(event) {
            event.preventDefault();

            const title = document.getElementById('taskTitle').value.trim();
            if (!title) {
                showNotification('Please enter a task title', 'error');
                return;
            }

            const description = document.getElementById('taskDescription').value;
            const category = document.getElementById('taskCategory').value.trim() || 'Other';
            const tags = document.getElementById('taskTags').value
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);
            const priority = document.getElementById('taskPriority').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const recurrence = document.getElementById('taskRecurrence').value;

            // Add category if it's new
            if (category && !categories.includes(category)) {
                categories.push(category);
                localStorage.setItem('categories', JSON.stringify(categories));
                updateCategoryOptions();
                updateCategoryFilters();
            }

            const newTask = {
                id: generateId(),
                title,
                description,
                category,
                tags,
                priority,
                dueDate,
                recurrence,
                completed: false,
                createdAt: new Date().toISOString()
            };

            tasks.push(newTask);
            saveTasks();
            renderTasks();

            // Reset form
            taskForm.reset();
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskRecurrence').value = 'none';

            showNotification('Task added successfully!');
        }

        // Toggle task completion
        function toggleTask(event) {
            const taskId = event.currentTarget.getAttribute('data-id');
            const task = tasks.find(t => t.id === taskId);

            if (task) {
                task.completed = !task.completed;

                // Handle recurring tasks
                if (task.completed && task.recurrence !== 'none') {
                    const newDueDate = new Date(task.dueDate || task.createdAt);

                    switch (task.recurrence) {
                        case 'daily':
                            newDueDate.setDate(newDueDate.getDate() + 1);
                            break;
                        case 'weekly':
                            newDueDate.setDate(newDueDate.getDate() + 7);
                            break;
                        case 'monthly':
                            newDueDate.setMonth(newDueDate.getMonth() + 1);
                            break;
                    }

                    // Create a new task for the next recurrence
                    const newTask = {
                        ...task,
                        id: generateId(),
                        completed: false,
                        dueDate: newDueDate.toISOString().split('T')[0]
                    };

                    tasks.push(newTask);
                    showNotification('Recurring task renewed!');
                }

                saveTasks();
                renderTasks();
            }
        }

        // Edit task
        function editTask(event) {
            const taskId = event.currentTarget.getAttribute('data-id');
            const task = tasks.find(t => t.id === taskId);

            if (task) {
                // Populate form with task data
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskCategory').value = task.category;
                document.getElementById('taskTags').value = task.tags.join(', ');
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskDueDate').value = task.dueDate;
                document.getElementById('taskRecurrence').value = task.recurrence;

                // Remove the task (we'll add it again with the form submission)
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();

                showNotification('Task loaded for editing');
            }
        }

        // Delete task
        function deleteTask(event) {
            const taskId = event.currentTarget.getAttribute('data-id');

            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== taskId);
                saveTasks();
                renderTasks();
                showNotification('Task deleted successfully');
            }
        }

        // Filter tasks
        function filterTasks(event) {
            // Update active filter button
            filterBtns.forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Set current filter and re-render
            currentFilter = event.currentTarget.getAttribute('data-filter');
            renderTasks();
        }

        // Filter by category - UPDATED VERSION
        function filterByCategory(event) {
            // Only process clicks on category tags
            if (!event.target.classList.contains('category-tag')) return;

            // Get the clicked category
            const clickedCategory = event.target.getAttribute('data-category');

            // Update active category
            currentCategory = clickedCategory;

            // Update UI to reflect the active category
            updateCategoryFilters();

            // Re-render tasks with the new filter
            renderTasks();
        }

        // Sort tasks
        function sortTasksHandler(event) {
            // Update active sort button
            sortBtns.forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Set current sort and re-render
            currentSort = event.currentTarget.getAttribute('data-sort');
            renderTasks();
        }

        // Search tasks
        function searchTasks() {
            searchQuery = searchInput.value;
            renderTasks();
        }

        // Toggle theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        // Export tasks
        function exportTasks() {
            const dataToExport = {
                tasks: tasks,
                categories: categories,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `taskflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('Tasks exported successfully!');
        }

        // Import tasks
        function importTasks() {
            importFile.click();
        }

        // Handle file import
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // Handle both old format (array of tasks) and new format (object with tasks and categories)
                    let importedTasks = [];
                    let importedCategories = [];

                    if (Array.isArray(importedData)) {
                        importedTasks = importedData;
                    } else if (importedData.tasks && Array.isArray(importedData.tasks)) {
                        importedTasks = importedData.tasks;
                        if (importedData.categories && Array.isArray(importedData.categories)) {
                            importedCategories = importedData.categories;
                        }
                    } else {
                        showNotification('Invalid file format', 'error');
                        return;
                    }

                    // Update categories from imported data
                    importedCategories.forEach(category => {
                        if (!categories.includes(category)) {
                            categories.push(category);
                        }
                    });

                    // Also extract categories from tasks
                    importedTasks.forEach(task => {
                        if (task.category && !categories.includes(task.category)) {
                            categories.push(task.category);
                        }
                    });

                    localStorage.setItem('categories', JSON.stringify(categories));
                    updateCategoryOptions();
                    updateCategoryFilters();

                    // Merge with existing tasks, avoiding duplicates
                    const existingIds = new Set(tasks.map(task => task.id));
                    const newTasks = importedTasks.filter(task => !existingIds.has(task.id));

                    tasks = [...tasks, ...newTasks];
                    saveTasks();
                    renderTasks();

                    showNotification(`Imported ${newTasks.length} tasks successfully!`);
                } catch (error) {
                    showNotification('Error importing tasks', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        // Share task list
        function shareTaskList() {
            // Create a shareable URL with task data (encoded)
            const shareData = {
                tasks: tasks,
                categories: categories
            };
            const taskData = btoa(JSON.stringify(shareData));
            const shareUrl = `${window.location.origin}${window.location.pathname}?tasks=${taskData}`;

            shareLink.value = shareUrl;
            shareModal.style.display = 'flex';
        }

        // Copy share link
        function copyShareLink() {
            shareLink.select();
            shareLink.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(shareLink.value).then(() => {
                showNotification('Link copied to clipboard!');
            }).catch(err => {
                showNotification('Failed to copy link', 'error');
            });
        }

        // Set reminder
        function setReminder() {
            // Load saved settings
            const savedTime = localStorage.getItem('reminderTime') || '09:00';
            const enableNotif = localStorage.getItem('enableNotifications') === 'true';

            document.getElementById('reminderTime').value = savedTime;
            enableNotifications.checked = enableNotif;

            reminderModal.style.display = 'flex';
        }

        // Save reminder
        function saveReminder() {
            const reminderTime = document.getElementById('reminderTime').value;
            const enableNotif = enableNotifications.checked;

            localStorage.setItem('reminderTime', reminderTime);
            localStorage.setItem('enableNotifications', enableNotif);

            // Request notification permission if enabled
            if (enableNotif && 'Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            reminderModal.style.display = 'none';
            showNotification('Daily reminder set!');

            // Reset last reminder so it triggers again today if needed
            localStorage.removeItem('lastReminder');
            checkReminders();
        }

        // Reset all data
        function resetAllData() {
            resetModal.style.display = 'flex';
        }

        // Confirm reset
        function confirmReset() {
            // Clear all data
            tasks = [];
            categories = ['Work', 'Personal', 'Shopping', 'Health', 'Other'];
            localStorage.removeItem('tasks');
            localStorage.removeItem('categories');
            localStorage.removeItem('lastReminder');

            // Reset form
            taskForm.reset();
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskRecurrence').value = 'none';

            // Reset filters
            currentFilter = 'all';
            currentCategory = 'all';
            currentSort = 'created';
            searchQuery = '';
            searchInput.value = '';

            // Update UI
            updateCategoryOptions();
            updateCategoryFilters();
            renderTasks();
            updateStats();

            resetModal.style.display = 'none';
            showNotification('All data has been reset!', 'warning');
        }

        // Cancel reset
        function cancelReset() {
            resetModal.style.display = 'none';
        }

        // Dismiss alarm
        function dismissAlarm() {
            alarmOverlay.style.display = 'none';
            stopAlarm();
        }

        // Close modals
        function closeModal() {
            shareModal.style.display = 'none';
            reminderModal.style.display = 'none';
            resetModal.style.display = 'none';
        }

        // Event listeners
        taskForm.addEventListener('submit', addTask);
        filterBtns.forEach(btn => btn.addEventListener('click', filterTasks));
        categoryFilters.addEventListener('click', filterByCategory);
        sortBtns.forEach(btn => btn.addEventListener('click', sortTasksHandler));
        searchInput.addEventListener('input', searchTasks);
        themeToggle.addEventListener('click', toggleTheme);
        exportBtn.addEventListener('click', exportTasks);
        importBtn.addEventListener('click', importTasks);
        importFile.addEventListener('change', handleFileImport);
        shareBtn.addEventListener('click', shareTaskList);
        remindersBtn.addEventListener('click', setReminder);
        resetDataBtn.addEventListener('click', resetAllData);
        closeModals.forEach(btn => btn.addEventListener('click', closeModal));
        copyLinkBtn.addEventListener('click', copyShareLink);
        saveReminderBtn.addEventListener('click', saveReminder);
        testAlarmBtn.addEventListener('click', testAlarm);
        confirmResetBtn.addEventListener('click', confirmReset);
        cancelResetBtn.addEventListener('click', cancelReset);
        addCategoryBtn.addEventListener('click', addNewCategory);
        dismissAlarmBtn.addEventListener('click', dismissAlarm);
        snoozeAlarmBtn.addEventListener('click', snoozeAlarm);

        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === shareModal) {
                shareModal.style.display = 'none';
            }
            if (event.target === reminderModal) {
                reminderModal.style.display = 'none';
            }
            if (event.target === resetModal) {
                resetModal.style.display = 'none';
            }
            if (event.target === alarmOverlay) {
                alarmOverlay.style.display = 'none';
                stopAlarm();
            }
        });

        // Check for shared tasks in URL
        function checkForSharedTasks() {
            const urlParams = new URLSearchParams(window.location.search);
            const sharedTasks = urlParams.get('tasks');

            if (sharedTasks) {
                try {
                    const importedData = JSON.parse(atob(sharedTasks));

                    // Handle both old and new format
                    let importedTasks = [];
                    let importedCategories = [];

                    if (Array.isArray(importedData)) {
                        importedTasks = importedData;
                    } else if (importedData.tasks && Array.isArray(importedData.tasks)) {
                        importedTasks = importedData.tasks;
                        if (importedData.categories && Array.isArray(importedData.categories)) {
                            importedCategories = importedData.categories;
                        }
                    }

                    if (importedTasks.length > 0) {
                        if (confirm('Would you like to import the shared task list?')) {
                            // Update categories from imported data
                            importedCategories.forEach(category => {
                                if (!categories.includes(category)) {
                                    categories.push(category);
                                }
                            });

                            // Also extract categories from tasks
                            importedTasks.forEach(task => {
                                if (task.category && !categories.includes(task.category)) {
                                    categories.push(task.category);
                                }
                            });

                            localStorage.setItem('categories', JSON.stringify(categories));
                            updateCategoryOptions();
                            updateCategoryFilters();

                            tasks = importedTasks;
                            saveTasks();
                            renderTasks();
                            showNotification('Shared tasks imported successfully!');

                            // Clean URL
                            window.history.replaceState({}, document.title, window.location.pathname);
                        }
                    }
                } catch (error) {
                    console.error('Error parsing shared tasks:', error);
                }
            }
        }

        // Initialize the app
        init();
        checkForSharedTasks();
    </script>
</body>

</html>